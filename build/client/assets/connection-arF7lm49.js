import{r as c,j as e,b as P,F as B}from"./components-DSNIqDDq.js";import{a as z,u as _,b as q,P as A,f as N,d as H}from"./createLucideIcon-Dkhr3css.js";import{d as O,e as V,M as K,S as W,a as X,f as $,b as G,c as D,g as Y,h as J}from"./select-Bg-tQMCJ.js";import{g as Q}from"./button-DJCNRe4M.js";import{c as E}from"./utils-DcAaEMf9.js";import{t as j}from"./x-BntEkNr0.js";import{I as g}from"./input-DUDTp-v9.js";var F="Checkbox",[Z,me]=z(F),[ee,te]=Z(F),R=c.forwardRef((r,d)=>{const{__scopeCheckbox:s,name:l,checked:n,defaultChecked:t,required:i,disabled:a,value:f="on",onCheckedChange:u,form:h,...C}=r,[x,p]=c.useState(null),b=_(d,m=>p(m)),o=c.useRef(!1),w=x?h||!!x.closest("form"):!0,[k=!1,S]=q({prop:n,defaultProp:t,onChange:u}),U=c.useRef(k);return c.useEffect(()=>{const m=x?.form;if(m){const y=()=>S(U.current);return m.addEventListener("reset",y),()=>m.removeEventListener("reset",y)}},[x,S]),e.jsxs(ee,{scope:s,state:k,disabled:a,children:[e.jsx(A.button,{type:"button",role:"checkbox","aria-checked":v(k)?"mixed":k,"aria-required":i,"data-state":M(k),"data-disabled":a?"":void 0,disabled:a,value:f,...C,ref:b,onKeyDown:N(r.onKeyDown,m=>{m.key==="Enter"&&m.preventDefault()}),onClick:N(r.onClick,m=>{S(y=>v(y)?!0:!y),w&&(o.current=m.isPropagationStopped(),o.current||m.stopPropagation())})}),w&&e.jsx(ae,{control:x,bubbles:!o.current,name:l,value:f,checked:k,required:i,disabled:a,form:h,style:{transform:"translateX(-100%)"},defaultChecked:v(t)?!1:t})]})});R.displayName=F;var I="CheckboxIndicator",L=c.forwardRef((r,d)=>{const{__scopeCheckbox:s,forceMount:l,...n}=r,t=te(I,s);return e.jsx(H,{present:l||v(t.state)||t.state===!0,children:e.jsx(A.span,{"data-state":M(t.state),"data-disabled":t.disabled?"":void 0,...n,ref:d,style:{pointerEvents:"none",...r.style}})})});L.displayName=I;var ae=r=>{const{control:d,checked:s,bubbles:l=!0,defaultChecked:n,...t}=r,i=c.useRef(null),a=O(s),f=Q(d);c.useEffect(()=>{const h=i.current,C=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(C,"checked").set;if(a!==s&&p){const b=new Event("click",{bubbles:l});h.indeterminate=v(s),p.call(h,v(s)?!1:s),h.dispatchEvent(b)}},[a,s,l]);const u=c.useRef(v(s)?!1:s);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n??u.current,...t,tabIndex:-1,ref:i,style:{...r.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function v(r){return r==="indeterminate"}function M(r){return v(r)?"indeterminate":r?"checked":"unchecked"}var se=R,ne=L;const ie=c.forwardRef(({className:r,...d},s)=>e.jsx(se,{ref:s,className:E("peer h-4 w-4 shrink-0  border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...d,children:e.jsx(ne,{className:E("flex items-center justify-center text-current"),children:e.jsx(V,{className:"w-4 h-4"})})})),T=c.forwardRef(({className:r,helperText:d,labelText:s,onChange:l,invalid:n,invalidText:t,hideLabel:i,readOnly:a,title:f="",warn:u,warnText:h,...C},x)=>{const p=!a&&!n&&u,b=!n&&!u,o=d?e.jsx("div",{className:"text-xs text-black opacity-50",children:d}):null;return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ie,{...C,"data-invalid":n?!0:void 0,className:"mt-0.5"+(n?" border-red-500":""),onCheckedChange:w=>{!a&&l&&l(!!w)},ref:w=>{typeof x=="function"?x(w):x&&"current"in x&&(x.current=w)},"aria-readonly":a}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm tracking-wide",title:f,children:s}),e.jsxs("div",{className:"flex items-start gap-2",children:[!a&&n&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"text-red-500 ",children:t})}),p&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"text-yellow-500 ",children:h})})]}),b&&o]})]})}),oe=({open:r,onClose:d,onSuccess:s,id:l})=>{const n=P(),[t,i]=c.useState("inactive"),[a,f]=c.useState("Deleting...");c.useEffect(()=>{n.data&&n.data.status=="success"?(f("Deleted!"),i("finished"),setTimeout(()=>{s(),d()},2e3)):n.data&&n.data.status=="error"&&(f(n.data.message||""),i("error"),setTimeout(()=>{i("inactive"),f("Deleting...")},2e3))},[n.data]);const u=async()=>{i("active"),n.submit({delete:{id:l}},{method:"POST",encType:"application/json",action:"/connections"})};return e.jsx(K,{open:r,danger:!0,loading:n.state=="loading"||n.state=="submitting",loadingDescription:a,modalHeading:"Delete Connection",modalLabel:"Database Connection",primaryButtonText:"Yes",secondaryButtonText:"No",onClose:d,onPrimaryClick:u,onSecondaryClick:d,children:e.jsx("h3",{children:"Are you sure you want to delete this connection?"})})},he=({open:r,onClose:d,onSuccess:s,mode:l="add",initialData:n=null})=>{const[t,i]=c.useState(n??{id:void 0,allowDiskUse:!0,name:"",connectionString:"",tls:!1,tlsAllowInvalidCertificates:!0,tlsCAFile:"",tlsCertificateKeyFile:"",tlsCertificateKeyFilePassword:"",maxPoolSize:4,whitelist:"",blacklist:""}),[a,f]=c.useState({}),u=P();c.useEffect(()=>{i(n??{id:void 0,allowDiskUse:!0,name:"",connectionString:"",tls:!1,tlsAllowInvalidCertificates:!0,tlsCAFile:"",tlsCertificateKeyFile:"",tlsCertificateKeyFilePassword:"",maxPoolSize:4,whitelist:"",blacklist:""})},[n]),c.useEffect(()=>{u.data&&u.data.status=="success"?(C(l=="edit"?"Updated":"Connected!"),j({title:l=="edit"?"Updated":"Connected!",type:"background"}),setTimeout(()=>{s(),d()},2e3)):u.data&&u.data.status=="error"&&(C(u.data.message||""),f(u.data.errors||{}),j({title:"Error",description:u.data.message||"An error occurred",variant:"error"}))},[u.data]);const[h,C]=c.useState("Connecting..."),[x,p]=c.useState(!1),b=async()=>{u.submit({[l]:t},{method:"POST",encType:"application/json",action:"/connections"})};return e.jsxs(e.Fragment,{children:[e.jsx(K,{open:r,danger:l=="edit",onClose:d,onPrimaryClick:l=="edit"?()=>{p(!0)}:b,loading:u.state=="loading"||u.state=="submitting",loadingDescription:h,modalHeading:l=="edit"?"Update Connection":"Create a new database connection",modalLabel:"Database Connection",onSecondaryClick:l=="edit"?b:void 0,primaryButtonText:l=="edit"?"Delete":"Create",secondaryButtonText:l=="edit"?"Update":"Cancel",children:e.jsx(B,{"aria-label":"Database Connection form",autoComplete:"new-password",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(g,{id:"name",labelText:"Name",type:"text",autoComplete:"new-password",required:!0,invalid:a.name,invalidText:a.name,helperText:"Enter a name for this connection",value:t.name,onChange:o=>{i({...t,name:o.target.value})}}),e.jsx("hr",{}),e.jsxs("div",{children:[e.jsx(g,{id:"connectionString",labelText:"Connection String",autoComplete:"new-password",type:"text",required:!0,invalid:a.connectionString,invalidText:a.connectionString,helperText:"ex: mongodb:// or mongodb+srv:// [username:password@]host[/[defaultauthdb][?options]]",value:t.connectionString,onChange:o=>{i({...t,connectionString:o.target.value})}}),e.jsx("a",{className:"text-xs text-blue-600 hover:underline",target:"_blank",href:"https://www.mongodb.com/docs/manual/reference/connection-string/",children:"View Documentation"}),e.jsxs("small",{className:"block mt-1",children:[e.jsx("b",{children:"*"}),"Use ",e.jsx("b",{children:'"directConnection=true"'})," parameter to run operations on host"," ",e.jsx("a",{className:"text-blue-600 hover:underline",target:"_blank",href:"https://www.mongodb.com/docs/drivers/node/v3.6/fundamentals/connection/connect/",children:"View More"})]})]}),e.jsx(T,{labelText:"TLS",helperText:"set to true to enable TLS/SSL",checked:t.tls,onChange:o=>{i({...t,tls:o})}}),e.jsxs("div",{className:"flex flex-col gap-4"+(t.tls?"":" hidden"),children:[e.jsx(T,{labelText:"TLS Allow Invalid Certificates",helperText:"validate mongod server certificate against CA",checked:t.tlsAllowInvalidCertificates,onChange:o=>{i({...t,tlsAllowInvalidCertificates:o})},disabled:!t.tls}),e.jsx(g,{id:"tlsCAFile",labelText:"TLS CA File",autoComplete:"new-password",type:"text",required:!0,invalid:a.tlsCAFile,invalidText:a.tlsCAFile,disabled:!t.tls,value:t.tlsCAFile,onChange:o=>{i({...t,tlsCAFile:o.target.value})}}),e.jsx(g,{id:"tlsCertificateKeyFile",autoComplete:"new-password",labelText:"TLS Certificate Key File",type:"text",required:!0,invalid:a.tlsCertificateKeyFile,invalidText:a.tlsCertificateKeyFile,disabled:!t.tls,value:t.tlsCertificateKeyFile,onChange:o=>{i({...t,tlsCertificateKeyFile:o.target.value})}}),e.jsx(g,{id:"tlsCertificateKeyFilePassword",labelText:"TLS Certificate Key File Password",type:"password",autoComplete:"new-password",required:!0,invalid:a.tlsCertificateKeyFilePassword,invalidText:a.tlsCertificateKeyFilePassword,disabled:!t.tls,value:t.tlsCertificateKeyFilePassword,onChange:o=>{i({...t,tlsCertificateKeyFilePassword:o.target.value})}})]}),e.jsx(g,{id:"maxPoolSize",labelText:"Max Pool Size",type:"number",min:1,max:100,value:t.maxPoolSize,onChange:o=>{i({...t,maxPoolSize:Number(o.target.value)})}}),e.jsx(g,{id:"whitelist",autoComplete:"new-password",labelText:"Whitelist",type:"text",invalid:!1,invalidText:"",helperText:"Comma separated list of databases (case sensitive)",value:t.whitelist,onChange:o=>{i({...t,whitelist:o.target.value})}}),e.jsx(g,{id:"blacklist",autoComplete:"new-password",labelText:"Blacklist",type:"text",helperText:"Comma separated list of databases (case sensitive)",invalid:!1,invalidText:"",value:t.blacklist,onChange:o=>{i({...t,blacklist:o.target.value})}}),e.jsx(T,{labelText:"Allow Disk Use",helperText:"set to true to remove the limit of 100 MB of RAM on each aggregation pipeline stage",checked:t.allowDiskUse,onChange:o=>{i({...t,allowDiskUse:o})}})]})})}),e.jsx(oe,{open:x,onClose:()=>p(!1),onSuccess:()=>{s(),d()},id:t.id})]})},pe=({current:r,connections:d})=>{const s=P(),[l,n]=c.useState(r);c.useEffect(()=>{if(l&&(s.state=="submitting"||s.state=="loading")){const a=d.find(f=>f.id==l.id);a&&j({title:"Connecting, Please wait...",description:`Connecting to "${a.name}"`,variant:"default"})}},[s.state]),c.useEffect(()=>{s.data&&s.data.status=="success"?window.location.href=s.data.redirect||"/":s.data&&s.data.status=="error"&&j({title:"Error",description:s.data.message,variant:"error"})},[s.data]);const t=a=>{if(!a||!a.id)return;const f=d.find(u=>u.id==a.id);f&&(n(f),s.submit({connect:{id:f.id}},{method:"POST",encType:"application/json",action:"/connections"}))};let i=d||[];return e.jsx(e.Fragment,{children:e.jsxs(W,{onValueChange:a=>{if(a=="new"){window.location.href="/connections";return}t(i.find(f=>f.id==a))},value:r?r.id:null,children:[e.jsx(X,{className:"w-[180px]",children:e.jsx($,{children:r?.name||"Select a connection"})}),e.jsxs(G,{className:"bg-white",children:[i.map(a=>e.jsx(D,{value:a.id,children:a.name},a.id)),e.jsxs(Y,{children:[e.jsx(J,{className:"mt-5 text-xs font-normal uppercase opacity-50",children:"New Connection"}),e.jsx(D,{className:"text-sm",value:"new",children:"Add New Connection"})]})]})]})})};export{he as C,pe as S};
