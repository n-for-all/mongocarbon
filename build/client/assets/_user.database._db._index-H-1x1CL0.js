import{u as A,r as o,a as k,j as s}from"./components-BPOIHgDc.js";import{B as m,P as B,T as D,S as F,a as E,D as O,A as M}from"./button-ZrFu6W_T.js";import{C as V,a as P}from"./collection-CQRtENl6.js";import{D as R}from"./database-D9MPVr0e.js";import{T as $,c as h,n as c}from"./functions-DMKVu1r-.js";import{A as q,a as U,b as W,c as H}from"./accordion-Cy3lx65E.js";import{A as G,a as J,b as K}from"./alert-Do9tp9-j.js";import{S as Q}from"./input-ChpOE9Lf.js";import{S as X,a as Y,b as Z,c as _}from"./select-Cem4k-Od.js";import{T as p,a as b,b as l,c as t}from"./table-CX2GO18n.js";import"./index-CZUknZXM.js";import"./utils-DcAaEMf9.js";import"./x-OohQberg.js";var u=(r=>(r.name="Name",r.documents="Documents",r["document-size"]="Avg. Document Size",r["storage-size"]="Storage Size",r.indexes="Indexes",r["index-size"]="Total Index Size",r))(u||{});function hs(){const r=A(),[f,C]=o.useState(""),[i,T]=o.useState("asc"),[w,g]=o.useState(!1),N=k(),[j,y]=o.useState(""),[I,z]=o.useState(!1),[v,S]=o.useState(null),a=r?.stats;if(r?.error)return s.jsxs(G,{children:[s.jsx(J,{children:"An error occurred while fetching the collection stats."}),s.jsx(K,{children:r.error})]});if(!a)return s.jsx("div",{children:"Loading..."});let L=0;switch(f){case"name":i=="desc"?a.collectionList.sort((e,n)=>n.name.localeCompare(e.name)):a.collectionList.sort((e,n)=>e.name.localeCompare(n.name));break;case"documents":i=="desc"?a.collectionList.sort((e,n)=>n.count-e.count):a.collectionList.sort((e,n)=>e.count-n.count);break;case"document-size":i=="desc"?a.collectionList.sort((e,n)=>{const d=n.stats.storageStats?.storageSize/n.count,x=e.stats.storageStats?.storageSize/e.count;return d-x}):a.collectionList.sort((e,n)=>{const d=e.stats.storageStats?.storageSize/e.count,x=n.stats.storageStats?.storageSize/n.count;return d-x});break;case"storage-size":i=="desc"?a.collectionList.sort((e,n)=>n.stats.storageStats?.storageSize-e.stats.storageStats?.storageSize):a.collectionList.sort((e,n)=>e.stats.storageStats?.storageSize-n.stats.storageStats?.storageSize);break;case"indexes":i=="desc"?a.collectionList.sort((e,n)=>n.indexes.length-e.indexes.length):a.collectionList.sort((e,n)=>n.indexes.length-e.indexes.length);break;case"index-size":i=="desc"?a.collectionList.sort((e,n)=>n.stats.storageStats?.totalIndexSize-e.stats.storageStats?.totalIndexSize):a.collectionList.sort((e,n)=>e.stats.storageStats?.totalIndexSize-n.stats.storageStats?.totalIndexSize);break}return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"database-page",children:[s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 pb-4 lg:flex-nowrap",children:[s.jsxs("div",{children:[s.jsxs($,{title:a.name,children:[s.jsx("span",{className:"font-normal opacity-50",children:"Database:"})," ",a.name]}),s.jsxs("p",{className:"mb-4 text-sm",children:["Collections: ",a.collections,", Documents: ",L]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx(m,{size:"sm",variant:"outline",iconPosition:"right",icon:s.jsx(B,{}),onClick:e=>{e.preventDefault(),z(!0)},children:"Create Collection"}),s.jsx(m,{size:"sm",variant:"error",icon:s.jsx(D,{}),onClick:e=>{e.preventDefault(),g(!0)},children:"Drop Database"})]})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(Q,{placeholder:"Find a collection",id:"search-collection",value:j,className:"w-32 min-w-md bg-neutral-100",onChange:e=>{y(e)}}),s.jsx("span",{className:"text-sm",children:"Sort:"}),s.jsxs(X,{onValueChange:e=>{C(e)},children:[s.jsx(Y,{children:s.jsx("span",{className:"text-sm",children:f==""?"---":u[f]})}),s.jsx(Z,{className:"bg-white",children:Object.keys(u).map(e=>s.jsx(_,{value:e,children:u[e]},e))})]}),s.jsx(m,{hasIconOnly:!0,variant:"ghost",tooltip:"Sort Direction",icon:i=="asc"?s.jsx(F,{}):s.jsx(E,{}),onClick:e=>{e.preventDefault(),T(i=="asc"?"desc":"asc")}})]})]}),a.collectionList.map((e,n)=>{if(j&&j.trim()!=""&&e.name.toLowerCase().indexOf(j.toLowerCase())!=0)return null;const d=e.stats.storageStats?.storageSize/e.count;return s.jsxs("div",{className:"mb-3 bg-neutral-100",children:[s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 px-4 py-2 text-base border-b border-solid border-neutral-200",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(O,{})," ",s.jsx("strong",{children:e.name})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx(m,{variant:"error",icon:s.jsx(D,{}),size:"sm",onClick:x=>{x.preventDefault(),S(e.name)},children:"Delete"}),s.jsx(m,{variant:"outline",icon:s.jsx(M,{}),size:"sm",href:`/database/${a.name}/${e.name}`,children:"View"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 px-4 py-2 lg:grid-cols-5",children:[s.jsxs("div",{className:"flex flex-col text-sm",children:[s.jsx("span",{className:"block mb-1 font-bold",children:"Storage size:"}),s.jsx("span",{className:"font-normal",children:h(e.stats.storageStats?.storageSize)})]}),s.jsxs("div",{className:"flex flex-col text-sm",children:[s.jsx("span",{className:"block mb-1 font-bold",children:"Documents:"}),s.jsx("span",{className:"font-normal",children:e.count})]}),s.jsxs("div",{className:"flex flex-col text-sm",children:[s.jsx("span",{className:"block mb-1 font-bold",children:"Avg. document size:"}),s.jsx("span",{className:"font-normal",children:h(d)})]}),s.jsxs("div",{className:"flex flex-col text-sm",children:[s.jsx("span",{className:"block mb-1 font-bold",children:"Indexes:"}),s.jsx("span",{className:"font-normal",children:e.indexes.length})]}),s.jsxs("div",{className:"flex flex-col text-sm",children:[s.jsx("span",{className:"block mb-1 font-bold",children:"Total index size:"}),s.jsx("span",{className:"font-normal",children:h(e.stats.storageStats?.totalIndexSize)})]})]}),s.jsx(q,{type:"multiple",children:s.jsxs(U,{value:"stats",title:"More Details",className:"pr-0 ",children:[s.jsx(W,{className:"px-4 border-t border-solid border-neutral-200",children:s.jsx("span",{className:"font-medium",children:"More Details"})}),s.jsx(H,{className:"px-0",children:s.jsxs("div",{className:"flex flex-col items-start w-full pb-4 lg:flex-row",children:[s.jsx("div",{className:"flex-1 w-full",children:s.jsx(p,{className:"text-md",children:s.jsxs(b,{children:[s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Namespace"}),s.jsx(t,{children:e.stats.ns})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Host"}),s.jsx(t,{children:e.stats.host})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Local Time"}),s.jsx(t,{children:e.stats.localTime})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Reads Latency"}),s.jsxs(t,{children:[c(e.stats.latencyStats?.reads.latency)," ms"]})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Writes Latency"}),s.jsxs(t,{children:[c(e.stats.latencyStats?.writes.latency)," ms"]})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Commands Latency"}),s.jsxs(t,{children:[c(e.stats.latencyStats?.commands.latency)," ms"]})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Transactions Latency"}),s.jsxs(t,{children:[c(e.stats.latencyStats?.transactions.latency)," ms"]})]})]})})}),s.jsx("div",{className:"flex-1 w-full",children:s.jsx(p,{className:"mt-4 text-md lg:mt-0",children:s.jsxs(b,{children:[s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Storage Size"}),s.jsxs(t,{children:[c(e.stats.storageStats?.storageSize)," B"]})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Total Index Size"}),s.jsxs(t,{children:[c(e.stats.storageStats?.totalIndexSize)," B"]})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Total Size"}),s.jsxs(t,{children:[c(e.stats.storageStats?.totalSize)," B"]})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Count"}),s.jsx(t,{children:e.count})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Collection Scans Total"}),s.jsx(t,{children:c(e.stats.queryExecStats?.collectionScans.total)})]}),s.jsxs(l,{children:[s.jsx(t,{className:"font-bold",children:"Collection Scans Non-Tailable"}),s.jsx(t,{children:c(e.stats.queryExecStats?.collectionScans.nonTailable)})]})]})})})]})})]})})]},n)}),s.jsx("div",{className:"flex items-center justify-between pb-4 mt-10",children:s.jsxs("div",{className:"",children:[s.jsx("h4",{className:"text-xl font-medium",children:"Details"}),s.jsxs("p",{className:"text-sm",children:["Collections: ",a.collections]})]})}),s.jsx(p,{className:"text-md",children:s.jsxs(b,{children:[s.jsxs(l,{children:[s.jsxs(t,{children:[s.jsx("strong",{children:"Collections "}),s.jsx("small",{className:"block",children:"(incl. system.namespaces)"})]}),s.jsx(t,{children:a.collections})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Data Size"})}),s.jsx(t,{children:a.dataSize})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Storage Size"})}),s.jsx(t,{children:a.storageSize})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Views"})}),s.jsx(t,{children:a.views})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Avg Obj Size"})}),s.jsx(t,{children:a.avgObjSize})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Objects"})}),s.jsx(t,{children:a.objects})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Operation Time"})}),s.jsx(t,{children:a.operationTime})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Cluster Time"})}),s.jsx(t,{children:a.clusterTime})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Extents"})}),s.jsx(t,{children:a.numExtents})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Extents Free List"})}),s.jsx(t,{children:a.extentFreeListNum})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Indexes"})}),s.jsx(t,{children:a.indexes})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Index Size"})}),s.jsx(t,{children:a.indexSize})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Data File Version"})}),s.jsx(t,{children:a.dataFileVersion})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"File System Used Size"})}),s.jsx(t,{children:h(a.fsUsedSize)})]}),s.jsxs(l,{children:[s.jsx(t,{children:s.jsx("strong",{children:"File System Total Size"})}),s.jsx(t,{children:h(a.fsTotalSize)})]})]})})]}),s.jsx(V,{open:I,onClose:()=>{z(!1)},onSuccess:(e,n)=>{N(`/database/${e}/${n}`,{replace:!0})},dbName:a.name}),s.jsx(P,{open:v!==null,onClose:()=>{S(null)},collectionName:v||"",onSuccess:()=>{S(null),window.location.reload()},dbName:a.name}),s.jsx(R,{open:w,onClose:()=>{g(!1)},onSuccess:()=>{g(!1),N("/database",{replace:!0})},name:a.name})]})}export{hs as default};
